# 09.19

## <div style="background-color: yellow;">SSR ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§</div>

> NextJSì˜ ê°€ì¥ ê¸°ë³¸ ë Œë”ë§<br/>
> ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ ì‚¬ì „ ë Œë”ë§ì„ ì§„í–‰<br/>
> âœ… getServerSideProps<br/>
> âœ… InferGetServerSidePropsType

### getServerSideProps | InferGetServerSidePropsType

ğŸ“Œ ì»´í¬ë„ŒíŠ¸ë³´ë‹¤ ë¨¼ì € í˜¸ì¶œë˜ì–´ì„œ ì„œë²„ì‚¬ì´ë“œë Œë”ë§ì— í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë“¤ì„ ì‹¤í–‰ <br/>
ğŸ“Œ ì»´í¬ë„ŒíŠ¸ëŠ” ì„œë²„ì—ì„œ í•œë²ˆ ë¸Œë¼ìš°ì €ì— ë Œë”ë§ í›„ í•œë²ˆ ì´ ë‘ë²ˆ í˜¸ì¶œëœë‹¤. ë”°ë¼ì„œ ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œ window.location ê°™ì€ ë¡œì§ì„ ì‚¬ìš©í•  ê²½ìš°, <br/>
ì„œë²„ì—ì„œ window ë¸Œë¼ìš°ì €ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŒìœ¼ë¡œ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.<br/>
ğŸ“Œ useEffectëŠ” ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì‹¤í–‰ëœë‹¤.

```tsx
// index.tsx

// ğŸ“Œ ì•½ì†ëœ í•¨ìˆ˜ëª… getServerSidePropsë¥¼ export í•˜ë©´ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ëŠ” ì„œë²„ì‚¬ì´ë“œë Œë”ë§ìœ¼ë¡œ ë™ì‘í•œë‹¤.
// ğŸ“Œ ë¬´ì¡°ê±´ propsë¥¼ í‚¤ë¡œ ê°–ëŠ” ê°ì²´ë¥¼ ë¦¬í„´í•´ì•¼í•œë‹¤.
// ğŸ“Œ ë¦¬í„´í•œ propsëŠ” ì»´í¬ë„ŒíŠ¸ì˜ propsë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
// ğŸ“Œ ì„œë²„ ì¸¡ì—ì„œ ë”± í•œë²ˆë§Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜.
export const getServerSideProps = () => {
  return {
    props: { data },
  };
};

export default function Home({
  data,
}: InferGetServerSidePropsType<typeof getServerSideProps>) {}
```

---

### SSR ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ ì‹¤ìŠµ

```ts
// fetch.ts

export interface ResponseWrapper<T> {
  code: number;
  msg: string;
  data: T;
}

export interface IBook {
  id: number;
  title: string;
  subTitle: string;
  author: string;
  publisher: string;
  description: string;
  coverImgUrl: string;
}

export default async function fetchBooks(): Promise<ResponseWrapper<IBook[]>> {
  const url = `http://localhost:12345/book`;

  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error();
    }

    return await response.json();
  } catch (err) {
    console.error(err);
    return [];
  }
}
```

```tsx
// index.tsx
import fetchBooks from "@/api/fetch";
import type { IBook } from "@/api/fetch";

// ğŸ“Œ getServerSidePropsì—ì„œ ë°ì´í„° í˜¸ì¶œ
export const getServerSideProps = async () => {
  const { data: allBooks } = await fetchBooks();

  return { props: allBooks };
};

export default function Home({
  allBooks,
}: InferGetServerSidePropsType<typeof getServerSideProps>) {
  return (
    <>
      <h1>Book List</h1>
      {allBooks.map((book) => (
        <div key={book.id}>
          <span>book.title</span>
          <span>book.subTitle</span>
          <span>book.author</span>
        </div>
      ))}
    </>
  );
}
```

---

### context: GetServerSidePropsContext

> ë°ì´í„° í˜¸ì¶œ + ì¿¼ë¦¬ìŠ¤íŠ¸ë§

```tsx
import fetchBooks from '@/api/book'

// index.tsx
// ğŸ“Œ context : í˜„ì¬ ë¸Œë¼ìš°ì €ë¡œë¶€í„° ë°›ì€ ëª¨ë“  ìš”ì²­ ( ì¿¼ë¦¬ìŠ¤íŠ¸ë§ ë°ì´í„°ë„ í¬í•¨ë˜ì–´ ìˆìŒ )
export const getServerSideProps = async (context: GetServerSidePropsContext) => {
  const query = context.query
  const searchValue = query.search

  if(!searchValue) return
  const books = await fetchBooks(searchValue as string)

  return {
    props: { books }
  }
}

export default function Page({ books }: InferGetServerSidePropsType<typeof getServerSideProps>) {

  return (
    <>
      { books.map(b => (
        <div>
          {b.title}
        </div>
      )) }
    </div>
  )
}
```

> ë°ì´í„° í˜¸ì¶œ + URL íŒŒë¼ë¯¸í„°

```tsx
export const getServerSideProps = async (
  context: GetServerSidePropsContext
) => {
  const params = context.params;
  if (!params) return;
  const bookID = params.id;
  if (!bookID) return;
  const book = await fetchBook(bookID as string);

  return {
    props: { book },
  };
};

export default function Page({
  book,
}: InferGetServerSidePropsType<typeof getServerSideProps>) {
  return (
    <>
      <h1>Book Detail</h1>
      <div>{book.title}</div>
    </>
  );
}
```
